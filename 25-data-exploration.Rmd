---
title: "25 - Data Exploration"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

# Structure
I am now going to explore the tidy version of the 2004-2018 Bolivia data to find factors that influence my question: who is likely to be asked by the police for a bribe.

## Reading through questions
Familiarizing myself with the questions asked, so I might understand what questions and factors could be relevant using `tabyl()`

```{r, message=FALSE}
library(janitor)
library(varhandle)
```

```{r}
bolivia_clean %>% 
  tabyl(question_es)
```

```{r}
bolivia_clean %>% 
  filter(question_es == "Ideología (izquierda / derecha)")
```

Making space for memory
```{r}
rm.all.but("bolivia_clean")
```

I had to omit 2 variables, but they were unrelated to the topic, so it works out. My computer otherwise would not have had sufficient memory to widen the data.

```{r}
labelled_wide <- bolivia_clean %>% 
  head(2200000) %>% # Get first 2.2 million rows to reduce memory
  pivot_wider(id_cols = c(person_id_factor, country, wave), 
              names_from = question_es,
              values_from = answer_dimension)
```

```{r}
labelled_wide <- labelled_wide %>% 
  rename(ideology = "Ideología (izquierda / derecha)") %>% 
  rename(police_bribe = "Oficial de Policía le solicitó un soborno") %>% 
  clean_names()
```

Changing to NA values
```{r}
#Function to create NA values in Bolivia dataset
turn_to_NA <- function(country){
  country <- set_na(country, na = c("No se le preguntó en este país o año", "Not asked in this country or year","No Aplica", "No Sabe", "No sabe", "No Responde", "No responde"), as.tag = TRUE)
}

#Changing above values to NA
labelled_wide <- turn_to_NA(labelled_wide)

#Checking to make sure the function worked
labelled_wide %>% 
  select(police_bribe) %>% 
  filter(!is.na(police_bribe))
```

Splitting up the age values for easier reading. Ages range from 18 to 85.
```{r}
#Setting up cut off values
breaks <- c(18, 27, 28, 37, 38, 47, 48, 57, 58, 67, 68, 77, 78, 87)

#Making interval labels
tags <- c("18 - 27", "28 - 37", "38 - 47", "48 - 57", "58 - 67", "68 - 77", "78 - 87")

#Bucketing values into bins
labelled_wide <- labelled_wide %>% 
  transform(edad = as.numeric(edad))

group_tags <- labelled_wide %>% 
  mutate(age = cut(labelled_wide$edad,
                  breaks = seq(18, 87, 10),
                  include.lowest = TRUE))

group_tags
```


# !DO NOT USE REFERENCE ONLY
#```{r}
#numeric_wide <- bolivia_clean %>% 
#  head(2200000) %>% # Get first 100K questions to reduce memory %>%
#  pivot_wider(id_cols = c(person_id_factor, country, wave), 
#              names_from = question_es,
#              values_from = answer_measure)
#```